# AIアシスタント機能スコープ

## 概要
QR勤怠管理システムのAIアシスタントは、ユーザーが自然言語で操作や質問を行えるようにする機能です。Gemini 2.5 Flash-Lite Previewを使用し、Function Callingによってシステムの機能を直接操作できます。

## 実装予定機能

### 1. ヘルプ・使い方案内
- **機能説明**: システムの使い方や機能について質問対応
- **想定質問例**:
  - "この勤怠管理システムの使い方を教えて"
  - "QRコードはどうやって生成するの？"
  - "月次レポートの見方を教えて"
  - "スタッフの勤務パターンはどう設定するの？"

### 2. スタッフ管理機能
- **スタッフ追加**: 名前、勤務パターン等を指定してスタッフを新規作成
- **スタッフ情報検索**: 名前やIDでスタッフ情報を検索・表示
- **スタッフ情報更新**: 既存スタッフの情報を更新
- **想定操作例**:
  - "田中太郎というスタッフを追加して"
  - "山田花子の情報を教えて"
  - "佐藤次郎の勤務パターンを変更して"

### 3. QRコード関連機能
- **個人QRコード生成**: 特定スタッフのQRコードを生成・表示
- **QR設定確認**: 現在のQR設定（有効期限等）を確認
- **想定操作例**:
  - "田中太郎のQRコードを作って"
  - "山田花子のQRコードを見せて"
  - "QRコードの設定を確認して"

### 4. 勤怠データ照会
- **出勤状況確認**: 特定スタッフの出勤状況を確認
- **月次データ取得**: 指定月の勤怠データを取得
- **異常データ検出**: 複数出勤や長時間勤務等の確認
- **想定操作例**:
  - "今日の出勤状況を教えて"
  - "田中太郎の今月の勤怠を確認して"
  - "複数出勤があるスタッフを教えて"

### 5. レポート・分析機能
- **勤怠サマリー**: 全体の勤怠状況をサマリー表示
- **統計情報**: 平均勤務時間、出勤率等の統計
- **想定操作例**:
  - "今月の全体の勤怠状況を教えて"
  - "平均勤務時間を計算して"

## 技術実装方針

### Function Calling設計
1. **Convex関数との連携**: 既存のConvex関数をAIから呼び出し可能にする
2. **権限管理**: 認証されたユーザーのみが操作可能
3. **エラーハンドリング**: 操作失敗時の適切なエラーメッセージ

### 対応するConvex関数
- `staff.createStaff`: スタッフ作成
- `staff.getStaff`: スタッフ情報取得
- `staff.updateStaff`: スタッフ情報更新
- `staff.listStaff`: スタッフ一覧取得
- `qrAttendanceUrl.generateQRCode`: QRコード生成
- `attendance.getAttendanceByStaff`: 個人勤怠データ取得
- `calendar.getMonthlyAttendance`: 月次勤怠データ取得

### AIプロンプト設計
```
あなたはQR勤怠管理システムの専門アシスタントです。
以下の機能を提供できます：
1. システムの使い方説明
2. スタッフ管理（追加・更新・検索）
3. QRコード生成・管理
4. 勤怠データの照会・分析
5. レポート生成

ユーザーの要求に応じて適切な関数を呼び出し、結果を分かりやすく説明してください。
```

## 実装フェーズ

### フェーズ1: 基本機能（優先度: 高）
- [x] 基本的な会話機能
- [x] ヘルプ・使い方案内
- [ ] スタッフ追加機能
- [ ] QRコード生成機能

### フェーズ2: 拡張機能（優先度: 中）
- [ ] スタッフ情報検索・更新
- [ ] 勤怠データ照会
- [ ] 基本的なレポート機能

### フェーズ3: 高度な分析（優先度: 低）
- [ ] 統計分析機能
- [ ] 異常検出機能
- [ ] 予測分析機能

## セキュリティ考慮事項
- **認証チェック**: 全ての操作で認証状態を確認
- **権限管理**: 管理者のみ実行可能な操作の制限
- **データ保護**: 個人情報の適切な取り扱い
- **ログ記録**: AI操作の監査ログ

## ユーザビリティ考慮事項
- **自然言語処理**: 日本語での自然な対話
- **エラー説明**: 分かりやすいエラーメッセージ
- **操作確認**: 重要な操作前の確認プロンプト
- **結果表示**: 操作結果の視覚的な表示

---

**作成日**: 2025年1月27日  
**更新日**: 2025年1月27日  
**バージョン**: 1.0 